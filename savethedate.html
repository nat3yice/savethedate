<!DOCTYPE html>
<html lang='eng'>

<head>
  <!-- Hotjar Tracking Code for www.nathanandnikita.com -->
  <script>
    (function (h, o, t, j, a, r) {
      h.hj = h.hj || function () { (h.hj.q = h.hj.q || []).push(arguments) };
      h._hjSettings = { hjid: 721376, hjsv: 6 };
      a = o.getElementsByTagName('head')[0];
      r = o.createElement('script'); r.async = 1;
      r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
      a.appendChild(r);
    })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
  </script>
  <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
  <script>
      // Initialize Firebase
      // TODO: Replace with your project's customized code snippet
      var config = {
        databaseURL: "https://rsvp-dbb88.firebaseio.com"
      };
      firebase.initializeApp(config);
      var database = firebase.database();

  </script>

  <meta charset='UTF-8'>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Nathan and Nikita!</title>
  <link href="https://fonts.googleapis.com/css?family=Glass+Antiqua" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Dawning+of+a+New+Day" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Cutive+Mono" rel="stylesheet">
  <link rel='stylesheet' href='styles.css' />
  <style type="text/css">
    .hero {
      font-family: 'Dawning of a New Day', cursive;
    }

    .details,
    .location,
    #login-button,
    .overlay-content,
    .input-box,
    #take-me-in-btn {
      font-family: 'Glass Antiqua', cursive;
    }
  </style>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0' />
  <link href='img-vid/favicon.png' rel="shortcut icon" type="image/png" />

  <script>
    var accomodation = "none";
    var visitorCode = null;
    var visitor = null;

    function openModal(modalName) {
      document.getElementById(modalName).style.display = "block";
      document.getElementById("outer-container").style.display = "none";
    }
    function closeModal(modalName) {
      document.getElementById(modalName).style.display = "none";
      document.getElementById("outer-container").style.display = "block";
    }

    function goToList() {
      visitorCode = document.getElementById("code-input").value;
      if(visitorCode.length < 1){
          alert("Please use your code!");
          return;
      }

      firebase.database().ref('/attendees/' + visitorCode).once('value').then(function(snapshot) {
        visitor = snapshot.val();
        var visitorEmail = document.getElementById("email-input").value;

        if (!validateVisitor(visitor, visitorEmail)) {
          alert("Invalid credentials");
        }
        else{

          //set number of visitor checkboxes
          var names = visitor.names;
          var attendeesList = document.getElementById("attendeesList");

          for(var i = 0; i < names.length; i++){

            //Name
            var para = document.createElement("p");
            var node = document.createTextNode(names[i]);
            var br = document.createElement("br");
            para.appendChild(node);

            //Yes Radio button  
            var yesInput = document.createElement("input");
            yesInput.setAttribute('type',"radio");
            yesInput.setAttribute('name', names[i]);
            yesInput.setAttribute('id', names[i]+" yes");
            yesInput.setAttribute('value', "yes");
            yesInput.setAttribute('onClick', "checkAttendees()");
            yesInput.innerHTML = "yes";

            var yesLabel = document.createElement("label");
            yesLabel.setAttribute('for', names[i]);
            yesLabel.innerHTML = "yes";

            //No Radio button
            var noInput = document.createElement("input");
            noInput.setAttribute('type',"radio");
            noInput.setAttribute('name', names[i]);
            noInput.setAttribute('id', names[i]+" yes");
            noInput.setAttribute('value', "no");
            noInput.setAttribute('onClick', "checkAttendees()");
            noInput.innerHTML = "no";

            var noLabel = document.createElement("label");
            noLabel.setAttribute('for', names[i]);
            noLabel.innerHTML = "no";

            attendeesList.appendChild(para);
            attendeesList.appendChild(br);
            attendeesList.appendChild(yesInput);
            attendeesList.appendChild(yesLabel);
            attendeesList.appendChild(br);
            attendeesList.appendChild(noInput);
            attendeesList.appendChild(noLabel);
            attendeesList.appendChild(br);
          }

          var details = document.getElementById("details");
          for(var i = 0; i < names.length; i++){
            var br = document.createElement("br");

            var songInput = document.createElement("input");
            songInput.setAttribute('type', "text");
            songInput.setAttribute('value', "");
            songInput.setAttribute('placeholder', "song");
            songInput.setAttribute('id', "song"+i);
            songInput.setAttribute('class', "input-box song");

            var artistInput = document.createElement("input");
            artistInput.setAttribute('type', "text");
            artistInput.setAttribute('value', "");
            artistInput.setAttribute('placeholder', "artist");
            artistInput.setAttribute('id', "artist"+i);
            artistInput.setAttribute('class', "input-box song");

            details.appendChild(songInput);
            details.appendChild(artistInput);
            details.appendChild(br);
          }

          closeModal("myNav");
          disableAll();
          openModal("myList");
        }
        
      });
    }

    function sorryMessage() {
      closeModal("sorryMessage");
      openModal("sorryBye");
    }

    function validateVisitor(visitor, email) {
      if (visitor === null || visitor.emails.indexOf(email) < 0) {
          return false;
      }
      return true;
    }

    function iWantCamping() {
      accomodation = "camping";
      console.log("Camping it is!");
      disableAccomodations();
    }

    function iWantHotel() {
      accomodation = "hotel";
      console.log("Hotel it is!");
      disableAccomodations();
    }

    function disableAccomodations(){
      changeAccomodations(true);
    }

    function enableAccomodations(){
      changeAccomodations(false);
    }

    function changeAccomodations(trueOrFalse) {
      document.getElementById("iWantHotel").disabled = trueOrFalse;
      document.getElementById("iWantCamping").disabled = trueOrFalse;
    }

    function disableSongs(){
      changeSongs(true);
    }

    function enableSongs(){
      changeSongs(false);
    }

    function changeSongs(trueOrFalse){
      var songInputs = document.getElementsByClassName("song");  
      for(var i = 0; i < songInputs.length; i++){
        songInputs[i].disabled = trueOrFalse;
      }
    }

    function disableAll(){
      disableAccomodations();
      disableSongs();
    }

    function enableAll(){
      enableAccomodations();
      enableSongs();
    }

    function finish(){
      closeModal("myList");

      //send firebase data.
      visitor["responded"] = true;
      visitor["accomodation"] = accomodation;

      var songAndArtistInputs = document.getElementsByClassName("song");
      var songs = [];
      for(var i = 0; i < visitor.names.length*2-1; i+=2){
        songs.push([songAndArtistInputs[i].value, songAndArtistInputs[i + 1].value]);
      }
      visitor["songs"] = songs;

      var names = [];
      for(var i = 0; i < visitor.names.length; i++){
        var name = visitor.names[i];
        var input = document.getElementById(name+" yes");
        names.push({"name" : name, "coming": input.checked});
      }
      visitor.names = names;

      visitor.message = document.getElementById("sorryMessageText").value;

      console.log(visitor);
      database.ref('attendees/' + visitorCode).set(visitor);
    }


    function checkAttendees() {
      var listModal = document.getElementById("attendeesList");
      var checkBoxes = listModal.getElementsByTagName("input");
      var numberCheckboxes = checkBoxes.length;
      var numberChecked = 0;
      var hasYeses = false;

      for (var i = 0; i < numberCheckboxes; i++) {
        if (checkBoxes[i].checked) {
          numberChecked++;
          if (checkBoxes[i].value === "yes") {
            hasYeses = true;
          }
        }
      }

      //All answered
      if (numberChecked * 2 >= numberCheckboxes) {
        console.log("Complete!");
        if (!hasYeses) {
          openModal("sorryMessage");
        }
        else{
          enableAll();
        }
      }
      else {
        console.log("More to go!");
      }
    }
  </script>
</head>

<body class='body'>
  <div class="fullscreen-bg">
    <video loop muted autoplay poster='img-vid/eng-540p-low-img.jpg' class="fullscreen-bg__video">
      <source src="img-vid/eng-540p-low.mp4" type="video/mp4">
    </video>
  </div>
  <div class='outer-container' id='outer-container'>
    <div class='outer'>
      <div class='hero'>
        <h1 id='names'>nathan & nikita</h1>
      </div>
      <div class='details'>
        <p id='wed-details'>
          <span>June 30
            <sup style="font-size: 13px !important">th</sup> 2018</span>
          <span>Oldehove &bull; The Netherlands
            <a href='https://goo.gl/maps/yj2srDnwXc42' target='_blank'>
              <img class='mapbutton' src='img-vid/mapicon-red.svg' alt='map pin drop icon'>
            </a>
          </span>
        </p>
        <div id='wed-details-mobile'>
          <p id='p-june30-mobile'>June 30
            <sup style='font-size: 11px !important'>th</sup> 2018</p>
          <p id='p-oldehove-mobile'>Oldehove</p>
          <p id='p-thenetherlands-mobile'>The Netherlands
            <a href='https://goo.gl/maps/yj2srDnwXc42' target='_blank'>
              <img class='mapbutton-mobile' src='img-vid/mapicon.svg' alt='map pin drop icon'>
            </a>
          </p>
        </div>
        <button type='button' id='login-button' class='button1' onclick="openModal('myNav')">Login</button>
      </div>
      <div class='location'>
        <p id='wed-location'>Shot at Lake Atitlan, Guatemala</p>
        <p id='wed-location-mobile'>Shot at Lake Atitlan, Guatemala</p>
      </div>
    </div>
  </div>
  <!-- Login Modal -->
  <div id="myNav" class="overlay">
    <a href="javascript:void(0)" class="closebtn" onclick="closeModal('myNav')">&times;</a>
    <div class="overlay-content">
      <p class="modal-message">Please use your invitation email and code we sent</p>
      <input class="input-box" id="email-input" type="text" tabindex="10" value="" placeholder="email">
      <br>
      <input class="input-box" id="code-input" type="text" value="" placeholder="code">
      <br>
      <input id="take-me-in-btn" type="button" onClick="goToList()" value="Take me in!">
    </div>
  </div>
  <div id="myList" class="overlay">
    <div class="overlay-content">
      <div id="attendeesList">
        <!-- Modal where people say yes/no -->
        <h2>List of people invited!</h2>
        <!-- NOTE: List of people will be generated when firebase data comes in -->
        
      </div>

      <!-- Modal where people write that they're sorry they can't go -->
      <div id="sorryMessage" style="display:none;">
        <h2>Sorry you can't come!</h2>
        <textarea id="sorryMessageText" name="Text1" cols="40" rows="5"></textarea>
        <input type="button" onClick="sorryMessage()" value="Submit">
      </div>
      <!-- Modal where people are sad -->
      <div id="sorryBye" style="display:none;">
        <h2>We'll have fun anyways!</h2>
        <p>No worries, we still love you!</p>
      </div>

      <!-- Modal where people fill in details -->
      <div id="details">
        <h2>All the info to know how things will work</h2>
        <h3>I want camping</h3>
        <input type="button" id="iWantCamping" onClick="iWantCamping()" value="Submit">
        <h3>I want hotel</h3>
        <input type="button" id="iWantHotel" onClick="iWantHotel()" value="Submit">
        <h3>Oh, hey what about the songs?</h3>
        <!-- NOTE: List of songs will be generated when firebase data comes in -->

      </div>

      <input type="button" id="finished" onClick="finish()" value="Save">

    </div>
  </div>

  </div>
</body>

</html>